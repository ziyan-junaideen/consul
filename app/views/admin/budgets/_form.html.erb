<%= render "admin/shared/globalize_locales", resource: @budget %>

<%= translatable_form_for [:admin, @budget] do |f| %>

  <%= render "shared/errors", resource: @budget %>

  <div class="small-12 medium-9 column">
    <%= f.translatable_fields do |translations_form| %>
    <%= translations_form.text_field :name,
        label: t("activerecord.attributes.budget.name"),
        maxlength: Budget.title_max_length,
        placeholder: t("activerecord.attributes.budget.name") %>
    <% end %>
  </div>

  <% if Setting["process.ideas"] %>
    <div class="row margin-top">
      <div class="small-12 medium-6 columns">
        <%= f.label :post_idea_uri, t('activerecord.attributes.budget.post_idea_uri') %>
        <p class="help-text"><%= t('activerecord.attributes.budget.post_idea_uri_help') %></p>
        <%= f.url_field :post_idea_uri, label: false %>
      </div>
    </div>

    <div class="row">
      <div class="small-12 medium-6 columns">
        <%= f.label :guest_ideas, t('activerecord.attributes.budget.guest_ideas') %>
        <p class="help-text"><%= t('activerecord.attributes.budget.guest_ideas_help') %></p>
        <%= f.select :guest_ideas, options_for_select([['Enabled', true], ['Disabled', false]], @budget.guest_ideas), label: false %>
      </div>

      <div class="small-12 medium-6 columns">
        <%= f.label :guest_ideas, t('activerecord.attributes.budget.budget_delegate_only') %>
        <p class="help-text"><%= t('activerecord.attributes.budget.budget_delegate_only_help') %></p>
        <%= f.select :budget_delegate_only, options_for_select([['Enabled', true], ['Disabled', false]], @budget.budget_delegate_only), label: false %>
      </div>
    </div>
  <% end %>

  <div class="margin-top">
    <div class="small-12 medium-7 column">
      <%= f.select :phase, options_for_select(budget_phases_select_options, @budget.phase), selected: "drafting" %>
      <p class="help-text"><%= t('admin.budgets.form.phase_help') %></p>
    </div>
    <div class="small-12 medium-5 column">
      <%= f.select :currency_symbol, budget_currency_symbol_select_options %>
    </div>
  </div>

  <% if @budget.phases.present? %>
    <div class="small-12 column">
      <table id="budget-phases-table" class="table-for-mobile">
        <thead>
          <tr>
            <th><%= t("admin.budgets.edit.phase") %></th>
            <th><%= t("admin.budgets.edit.dates") %></th>
            <th class="text-center"><%= t("admin.budgets.edit.enabled") %></th>
            <th><%= t("admin.budgets.edit.actions") %></th>
          </tr>
        </thead>

        <% @budget.phases.order(:id).each do |phase| %>
          <tr id="<%= dom_id(phase) %>" class="phase">
            <td>
              <%= t("budgets.phase.#{phase.kind}") %>
              <% if @budget.current_phase == phase %>
                <span class="label success"><strong><%= t("admin.budgets.edit.active") %></strong></span>
              <% end %>
            </td>
            <td>
              <% if phase.starts_at.present? || phase.ends_at.present? %>
                <%= l(phase.starts_at.to_date) if phase.starts_at.present? %>
                -
                <%= l(phase.ends_at.to_date) if phase.ends_at.present? %>
              <% else %>
                <em><%= t("admin.budgets.edit.blank_dates") %></em>
              <% end %>
            </td>
            <td class="text-center">
              <span class="budget-phase-enabled <%= phase.enabled? ? "enabled" : "disabled" %>"></span>
            </td>
            <td>
              <%= link_to t("admin.budgets.edit.edit_phase"),
                          edit_admin_budget_budget_phase_path(@budget, phase),
                          method: :get, class: "button hollow expanded" %>
            </td>
          </tr>
        <% end %>
      </table>
    </div>
  <% end %>

  <div class="small-12 column">
    <%= render "admin/shared/show_results_fields", form: f %>
  </div>

  <div class="small-12 column">
    <div class="clear small-12 medium-4 large-3 inline-block">
      <%= f.submit nil, class: "button success" %>
    </div>

    <div class="float-right">
      <% if display_calculate_winners_button?(@budget) %>
        <%= link_to calculate_winner_button_text(@budget),
                    calculate_winners_admin_budget_path(@budget),
                    method: :put,
                    class: "button hollow" %>
      <% end %>

      <% if @budget.has_winning_investments? %>
        <%= link_to t("budgets.show.see_results"),
                    budget_results_path(@budget),
                    class: "button hollow margin-left" %>
      <% end %>

      <% if @budget.persisted? %>
        <%= link_to t("admin.budgets.edit.delete"),
            admin_budget_path(@budget),
            method: :delete,
            class: "delete float-right margin-left" %>
      <% end %>
    </div>
  </div>

<% end %>
